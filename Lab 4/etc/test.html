<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Data Visualization Lab</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        .tooltip {
            position: absolute;
            background-color: white;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            pointer-events: none;
            opacity: 0;
        }
    </style>
</head>
<body>
    <svg width="800" height="400">
        <rect x="50" y="50" width="700" height="300" stroke="black" fill="none" />
    </svg>
    <div>
        <textarea id="salesInfo" rows="3" cols="30" readonly></textarea>
    </div>
    
    <!-- Tooltip Element -->
    <div class="tooltip" id="tooltip"></div>

    <script>
        d3.csv("sales_data_sample.csv").then(function(data) {
            // Data Processing
            const salesData = new Map();

            data.forEach(function(d) {
                const key = d.MONTH_ID + '/' + d.YEAR_ID; // Use '/' as the separator
                if (!salesData.has(key)) {
                    salesData.set(key, 0);
                }
                salesData.set(key, salesData.get(key) + parseFloat(d.SALES));
            });

            // Sort the map entries by key
            const sortedSalesData = new Map([...salesData.entries()].sort((a, b) => {
                const [aMonth, aYear] = a[0].split('/').map(Number);
                const [bMonth, bYear] = b[0].split('/').map(Number);

                if (aYear !== bYear) {
                    return aYear - bYear;
                } else {
                    return aMonth - bMonth;
                }
            }));

            // Linear Scales
            const svgWidth = 800;
            const svgHeight = 400;
            const svg = d3.select("svg")
                .attr("width", svgWidth)
                .attr("height", svgHeight);

            const plotWidth = 700; // Width of the plot area inside the rectangle
            const plotHeight = 300; // Height of the plot area inside the rectangle

            const xScale = d3.scaleLinear()
                .domain([0, sortedSalesData.size - 1])
                .range([50, 50 + plotWidth]); // Adjust the range based on the rectangle position and width

            const yScale = d3.scaleLinear()
                .domain([0, d3.max([...sortedSalesData.values()])])
                .range([50 + plotHeight, 50]); // Adjust the range based on the rectangle position and height

            // Axes
            const xAxis = d3.axisBottom(xScale)
                .tickFormat((d, i) => {
                    const keys = [...sortedSalesData.keys()];
                    if (i % 2 === 0) {
                        return keys[i];
                    } else {
                        return ""; // Hide even values
                    }
                });

            const yAxis = d3.axisLeft(yScale)
                .tickFormat(d3.format(".2s")) // Format ticks as 100k, etc.

            svg.append("g")
                .attr("class", "x-axis")
                .attr("transform", "translate(0," + (50 + plotHeight) + ")")
                .call(xAxis);

            svg.append("g")
                .attr("class", "y-axis")
                .attr("transform", "translate(50,0)") // Adjust the translation based on the rectangle position
                .call(yAxis);

            // Add X and Y axis titles
            svg.append("text")
                .attr("x", svgWidth / 2)
                .attr("y", svgHeight - 10)
                .style("text-anchor", "middle")
                .text("Month/Year");

            svg.append("text")
                .attr("x", -svgHeight / 2)
                .attr("y", 20)
                .style("text-anchor", "middle")
                .attr("transform", "rotate(-90)")
                .text("Total Sales");

            // Add Plot Title
            svg.append("text")
                .attr("x", svgWidth / 2)
                .attr("y", 30)
                .style("text-anchor", "middle")
                .style("font-size", "18px") // Adjust the font size as needed
                .text("Sales Revenues");

            // Plotting
            const pathData = [...sortedSalesData];
            const path = d3.line()
                .x(function(d, i) { return xScale(i); })
                .y(function(d) { return yScale(d[1]); });

            svg.append("path")
                .attr("d", path(pathData))
                .attr("fill", "none")
                .attr("stroke", "blue");

            // Mouse Interaction
            const tooltip = d3.select("#tooltip");
            svg.selectAll("circle")
                .data(pathData)
                .enter()
                .append("circle")
                .attr("cx", function(d, i) { return xScale(i); })
                .attr("cy", function(d) { return yScale(d[1]); })
                .attr("r", 5)
                .on("mouseover", function(event, d) {
                    tooltip.transition()
                        .duration(200)
                        .style("opacity", 0.9);
                    tooltip.html(`Sales Revenue: $${d[1].toFixed(2)}`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 20) + "px");
                })
                .on("mouseout", function() {
                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                });
        }).catch(function(error) {
            console.error("Error reading the CSV file:", error);
        });
    </script>
</body>
</html>
